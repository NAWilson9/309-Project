<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pieceConnector.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pieceConnector.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//Link dependencies
let config = require('./piece_connector_config.json');
const fs = require('fs');
const path = require('path');
const router = require('express').Router();
//Routing

/**
 * Helper function for post requests.
 *
 * If no ID is specified in the req body it sends an error to the client.
 * If an ID is specified it queries the server to see if a piece with the given ID exists.
 * If so the piece is updated, if not then the piece is created and stored.
 * Then the resulting updated or new piece is sent back to the client.
 * If an error is encountered then the error is sent to the client and execution stops.
 *
 * @param req - contains the information for the request
 * @param res - the object to send results to
 *
 *
 */
const piecePostHelper = function (req, res) {
    let id = req.body.id;

    if(!id){
        res.statusCode = 400;
        res.send("No id specified!");
        return;
    }
    if(Object.keys(req.body).length === 0 ){
        res.statusCode = 400;
        res.send("No body specified!");
        return;
    }
    let piece = config.pieces.find((piece) => piece.id === id);
    if(piece){
        config.pieces[config.pieces.indexOf(piece)] = req.body;
        fs.writeFile(path.join(__dirname, '/piece_connector_config.json'), JSON.stringify(config, null, 4), function(err){
            if(err) {
                res.statusCode = 500;
                res.send('Error saving new piece data.');
                console.error(new Date().toLocaleTimeString() + ' | Unable to save new piece data.');
                console.error(err);
                return;
            } else {
                res.send(piece);
                return;
            }
        });
    }
    else {
        config.pieces[config.pieces.length] = req.body;
        fs.writeFile(path.join(__dirname, '/piece_connector_config.json'), JSON.stringify(config, null, 4), function(err){
            if(err) {
                res.statusCode = 500;
                res.send('Error saving new piece data.');
                console.error(new Date().toLocaleTimeString() + ' | Unable to save new piece data.');
                console.error(err);
            } else {
                res.send(config.pieces[config.pieces.length-1]);
                return;
            }
        });
    }
};
router.post('/api/pieces', piecePostHelper);

/**
 * Helper function for get requests
 *
 * If IDs are specified in the req body it queries the server to get the information for each piece with a specified ID.
 * If one is not found then an error is sent to the requesting client and execution stops.
 * Otherwise all the pieces information is sent back to the client.
 * If a creator is specified it queries the server for all pieces created by that user.
 * If none are found it sends an error to the client.
 * Otherwise it sends the found pieces information to the client.
 *
 * @param req - contains the information for the request
 * @param res - the object to send results to
 *
 *
 */
const pieceGetHelper =function (req, res) {
    let ids = req.query.id;
    if(ids) {
        ids = ids.split(',');
    }
    let creator =  req.query.creator;
    if(!ids &amp;&amp; !creator){
        res.statusCode = 400;
        res.send("No ids or creator specified!");
        return;
    }
    if(ids &amp;&amp; creator){
        res.statusCode = 400;
        res.send("Both ids and creator specified!");
        return;
    }
    let returnPieces = [];
    if(creator){
        config.pieces.forEach(function (piece) {
            if(piece.creator==creator){
                returnPieces.push(piece);
            }
        });
        if(returnPieces.length === 0){
            res.statusCode = 404;
            res.send("creator not found!");
            return;
        }
        res.send(returnPieces);
    }
    if(ids){
        config.pieces.forEach(function (piece) {
            for(var i=0;i &lt; ids.length;i++) {
                if (piece.id == ids[i]) {
                    returnPieces.push(piece);
                    return;
                }
            }
        });
        if(returnPieces.length === 0 || returnPieces.length != ids.length){
            res.statusCode = 404;
            res.send("id/s not found!");
            return;
        }
        res.send(returnPieces);
    }
};

router.get('/api/pieces', pieceGetHelper);
module.exports = router;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#pieceGetHelper">pieceGetHelper</a></li><li><a href="global.html#piecePostHelper">piecePostHelper</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Mar 09 2017 21:53:02 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
